<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solve - {{ q.ques_title if q else 'No Question' }}</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs/loader.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/solve_and_compiler_page.css') }}">
</head>
<body>

<div class="container py-4">
    <div class="card shadow p-4">
        <h1 class="fw-bold">{{ q.title }}</h1>
        <p class="text-muted">Display ID: {{ q.question_id }}</p>
        <hr>
        <p class="lead">{{ q.description }}</p>

        <h5 class="label-heading mt-3">Input Format</h5>
        <p>{{ q.input_format }}</p>

        <h5 class="label-heading">Output Format</h5>
        <p>{{ q.output_format }}</p>

        <h5 class="label-heading">Constraints</h5>
        <div class="p-2 bg-light border rounded"><code>{{ q.constraints }}</code></div>

        <div class="row mt-4">
            <div class="col-md-6">
                <h5 class="label-heading">Sample Input</h5>
                <pre class="bg-dark text-white p-2">{{ q.sample_input }}</pre>
            </div>
            <div class="col-md-6">
                <h5 class="label-heading">Sample Output</h5>
                <pre class="bg-dark text-white p-2">{{ q.sample_output }}</pre>
            </div>
        </div>

        {% if q.explanation %}
        <h5 class="label-heading mt-3">Explanation</h5>
        <div class="alert alert-info">{{ q.explanation }}</div>
        {% endif %}
        
        <p><strong>Difficulty:</strong> <span class="badge bg-secondary">{{ q.difficulty }}</span></p>
    </div>

    <div class="compiler-section mt-5 border-top pt-4">
        <h3>Code Editor</h3>
        <select id="language" class="form-select mb-2 w-25" onchange="changeLang()">
            <option value="python">Python</option>
            <option value="c">C</option>
            <option value="cpp">C++</option>
            <option value="java">Java</option>
        </select>

        <div id="editor" style="height: 300px; border: 1px solid #ddd;"></div>

        <h3 class="mt-4">Input (stdin)</h3>
        <textarea id="input" class="form-control" rows="3" placeholder="Enter input here..."></textarea>

        <button class="btn btn-success mt-3" onclick="runCode()">â–¶ Run Code</button>

        <h3 class="mt-4">Output</h3>
        <pre id="output" class="bg-light p-3 border rounded" style="min-height: 50px;"></pre>
    </div>
</div>
<script>
    let editor;

    require.config({
        paths: { vs: "https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs" }
    });

    require(["vs/editor/editor.main"], function () {
        editor = monaco.editor.create(document.getElementById("editor"), {
            value: '# Write Your Code and enjoy the Day with python',
            language: "python",
            theme: "vs-dark",
            automaticLayout: true,
            scrollBeyondLastLine: false, // Set to false to prevent extra empty space
            scrollbar: {
                alwaysConsumeMouseWheel: false // CRITICAL: This allows the page to scroll when the editor scroll ends
                },
            contextmenu: false,
            copySelection: false,
            dragAndDrop: false,
            links: false
        });

        const editorElement = document.getElementById('editor');
        
        // Block Keyboard Shortcuts
        editorElement.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                const forbidden = ['c', 'v', 'x', 'a'];
                if (forbidden.includes(e.key.toLowerCase())) {
                    e.preventDefault();
                    e.stopPropagation();
                }
            }
        }, true); 

        // Block Mouse Events
        ['copy', 'cut', 'paste', 'contextmenu', 'drop'].forEach(eventType => {
            editorElement.addEventListener(eventType, (e) => {
                e.preventDefault();
                e.stopPropagation();
            }, true);
        });
    });

    function changeLang() {
        const lang = document.getElementById("language").value;
        let code = "";

        if (lang === "python") code = '# Write Your Code...';
        else if (lang === "c") code = '#include <stdio.h>\n\nint main() {\n    return 0;\n}';
        else if (lang === "cpp") code = '#include <iostream>\nusing namespace std;\n\nint main() {\n    return 0;\n}';
        else if (lang === "java") code = 'import java.util.*;\nimport java.io.*;\nclass Main {\n    public static void main(String[] args) {\n    }\n}';

        monaco.editor.setModelLanguage(editor.getModel(), lang === "cpp" ? "cpp" : lang);
        editor.setValue(code);
    }

    function runCode() {
        const outputField = document.getElementById("output");
        outputField.textContent = "Running...";
        fetch("/run", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                code: editor.getValue(),
                language: document.getElementById("language").value,
                input: document.getElementById("input").value
            })
        })
        .then(res => res.json())
        .then(data => {
            outputField.textContent = data.output || data.error || "No output.";
        });
    }
</script>

</body>
</html>